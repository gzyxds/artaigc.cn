---
/**
 * Header组件 - Bento Grid / Linear 风格优化版本
 * 网站的顶部导航栏组件，提供网站的主要导航功能
 * 优化内容：减少代码冗余，提升性能，简化数据结构，统一 Linear 设计风格
 */

import astroLogo from '../assets/logo.svg';

/**
 * 获取logo的URL - 处理Astro的SVG导入类型
 */
const logoUrl = typeof astroLogo === 'string' ? astroLogo : astroLogo.src;

/**
 * 优化的图标定义 - 使用更简洁的路径
 */
const icons = {
  user: "M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2M12 7a4 4 0 1 0 0-8 4 4 0 0 0 0 8z",
  brain: "M12 2a3 3 0 0 0-3 3 3 3 0 0 0-3 3v1a3 3 0 0 0 3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0 3-3V8a3 3 0 0 0-3-3 3 3 0 0 0-3-3z",
  chat: "M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",
  edit: "M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z",
  target: "M12 2a10 10 0 1 0 0 20 10 10 0 0 0 0-20zM12 6a6 6 0 1 0 0 12 6 6 0 0 0 0-12zM12 10a2 2 0 1 0 0 4 2 2 0 0 0 0-4z",
  monitor: "M2 3h20v14H2zM8 21h8M12 17v4",
  lightbulb: "M9 21h6M12 17v4M12 3a6 6 0 0 1 6 6c0 3-2 5.5-2 8H8c0-2.5-2-5-2-8a6 6 0 0 1 6-6z",
  shield: "M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z",
  chevron: "M19 9l-7 7-7-7",
  arrow: "M9 5l7 7-7 7",
  menu: "M4 6h16M4 12h16M4 18h16",
  close: "M6 18L18 6M6 6l12 12",
  sun: "M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z",
  moon: "M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"
};

/**
 * 优化的菜单项接口 - 移除未使用的color字段
 */
interface MenuItem {
  name: string;
  url: string;
  icon: keyof typeof icons;
  desc: string;
  target?: string;
}

/**
 * 菜单数据 - 合并相似配置，减少重复
 */
const menuData = {
  products: [
    { name: "产品中心", url: "/shop", icon: "target", desc: "全部产品导航" },
    { name: "数字分身", url: "/human", icon: "monitor", desc: "智能数字人解决方案" },
    { name: "全能知识库", url: "/ai", icon: "lightbulb", desc: "企业级全能AI平台" },
    { name: "聊天绘画", url: "/chat", icon: "chat", desc: "智能对话与创作" },
    { name: "论文创作", url: "/paper", icon: "edit", desc: "智能论文写作助手" },
     { name: "产品演示", url: "/demo", icon: "monitor", desc: "在线体验中心" },
    { name: "AI提示词", url: "/tips", icon: "lightbulb", desc: "AI提示词大全" },
    { name: "授权中心", url: "https://console.cloudcvm.com/home.htm", icon: "shield", desc: "授权管理与使用", target: "_blank" },
  ],
  docs: [
    { name: "项目文档", url: "https://doc.artaigc.cn/", icon: "lightbulb", desc: "5分钟快速上手", target: "_blank" },
    { name: "飞书文档", url: "https://rwm01l8tn3x.feishu.cn/wiki/VqNCwBO0KiqWIWkSfdHcDigGnZg?from=from_copylink", icon: "monitor", desc: "详细功能说明", target: "_blank" },
    { name: "数字分身", url: "https://doc.artaigc.cn/human/", icon: "user", desc: "数字人部署文档", target: "_blank" },
    { name: "全能知识库", url: "https://doc.artaigc.cn/work/deployment/demo.html", icon: "brain", desc: "企业知识库数文档", target: "_blank" },
    { name: "聊天绘画", url: "https://doc.artaigc.cn/chat/", icon: "chat", desc: "聊天绘画企业知识库数文档", target: "_blank" },
    { name: "论文创作", url: "https://doc.artaigc.cn/Paper/deployment/bt.html", icon: "edit", desc: "论文创作文档", target: "_blank" },
  ],
  support: [
    { name: "更新日志", url: "/changelog", icon: "shield", desc: "获取最新更新" },
    { name: "联系我们", url: "/contact", icon: "chat", desc: "获取专业支持服务" },
    { name: "集成与API", url: "/integrations", icon: "monitor", desc: "连接您喜爱的工具" },
    { name: "合作伙伴", url: "/cooperate", icon: "user", desc: "查看合作机会" },
    { name: "渠道合作", url: "/channel", icon: "target", desc: "渠道合作与加盟" },
    { name: "APP下载", url: "/app", icon: "lightbulb", desc: "多终端APP下载" },
  ]
} as const;

/**
 * 优化的图标组件 - 减少DOM节点
 */
const Icon = ({ name, className = "w-5 h-5" }: { name: keyof typeof icons; className?: string }) => (
  `<svg class="${className}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="${icons[name]}"/></svg>`
);
---

<!-- 主导航栏 -->
<header class="sticky top-0 z-50 bg-white/90 backdrop-blur-md border-b border-gray-200 dark:bg-gray-900/90 dark:border-gray-800 transition-colors duration-300">
  <div class="container-custom">
    <div class="flex items-center h-16">
      <!-- Logo区域 -->
      <div class="flex items-center">
        <a href="/" class="flex items-center space-x-2 group">
          <div class="p-1 border border-transparent group-hover:border-blue-500/20 transition-colors duration-300">
            <img src={logoUrl} alt="艺创AI" class="h-8 w-8" />
          </div>
          <span class="text-xl font-bold font-mono text-gray-900 dark:text-white tracking-tight">ART.AI</span>
        </a>
      </div>

      <!-- 桌面端导航菜单 -->
      <nav class="hidden lg:flex items-center space-x-1 ml-8 xl:ml-12">
        <a href="/" class="nav-link">首页</a>

        <!-- 企业级简约下拉菜单组件 -->
        {Object.entries(menuData).map(([key, items]) => {
          const menuName = key === 'products' ? '产品中心' : key === 'docs' ? '产品文档' : '支持与服务';
          return (
            <div class="relative group">
              <button class="nav-link flex items-center whitespace-nowrap group/btn">
                <span class="group-hover/btn:text-blue-600 dark:group-hover/btn:text-blue-400 transition-colors duration-200">
                  {menuName}
                </span>
                <svg class="ml-1 h-3 w-3 transition-all duration-300 group-hover:rotate-180 text-gray-400 group-hover/btn:text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d={icons.chevron} />
                </svg>
              </button>

              <!-- 企业级简约下拉容器 -->
              <div class="absolute left-0 top-full mt-0 w-[480px] bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-none opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 translate-y-1 group-hover:translate-y-0 shadow-lg shadow-gray-200/20 dark:shadow-none">
                <div class="corner-marker top-0 right-0 border-t border-r rounded-bl-none w-2 h-2"></div>
                <div class="corner-marker bottom-0 left-0 border-b border-l rounded-tr-none w-2 h-2"></div>

                <!-- 菜单标题区域 -->
                <div class="px-5 py-3 border-b border-gray-100 dark:border-gray-800 bg-gray-50/50 dark:bg-gray-800/50">
                  <h3 class="text-xs font-bold font-mono text-gray-900 dark:text-gray-100 tracking-wide uppercase">
                    {menuName}
                  </h3>
                </div>

                <!-- 菜单项网格 -->
                <div class="p-2">
                  <div class="grid grid-cols-2 gap-0">
                    {items.map((item) => (
                      <a href={item.url} target={(item as MenuItem).target || undefined} class="enterprise-menu-item group/item">
                        <div class="flex items-start space-x-3 p-3 rounded-none hover:bg-gray-50 dark:hover:bg-gray-800 transition-all duration-200 border border-transparent hover:border-gray-200 dark:hover:border-gray-700">

                          <!-- 简约图标区域 -->
                          <div class="flex-shrink-0 mt-0.5">
                            <div class="w-8 h-8 rounded-none bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 flex items-center justify-center group-hover/item:border-blue-500/30 transition-colors duration-200">
                              <span class="w-4 h-4 text-gray-500 dark:text-gray-400 group-hover/item:text-blue-600 dark:group-hover/item:text-blue-400 transition-colors duration-200" set:html={Icon({ name: item.icon, className: "w-4 h-4" })}></span>
                            </div>
                          </div>

                          <!-- 文本内容区域 -->
                          <div class="flex-1 min-w-0">
                            <div class="text-sm font-bold font-mono text-gray-900 dark:text-gray-100 group-hover/item:text-blue-600 dark:group-hover/item:text-blue-400 transition-colors duration-200 leading-tight">
                              {item.name}
                            </div>
                            <div class="text-[10px] text-gray-500 dark:text-gray-400 mt-1 leading-relaxed line-clamp-1 font-mono">
                              {item.desc}
                            </div>
                          </div>
                        </div>
                      </a>
                    ))}
                  </div>
                </div>
               </div>
            </div>
          );
        })}

        <a href="/pricing" class="nav-link">产品价格</a>
        <a href="/company" class="nav-link">关于我们</a>
        <a href="/contact" class="nav-link">联系我们</a>
        <a href="/blog" class="nav-link">最新动态</a>
      </nav>

      <!-- 右侧操作区域 -->
      <div class="flex items-center space-x-0 ml-auto border-l border-gray-200 dark:border-gray-800 pl-4">
        <!-- 暗黑模式切换按钮 -->
        <button
          x-on:click="darkMode = !darkMode"
          class="p-2.5 rounded-none text-gray-500 hover:text-blue-600 dark:text-gray-400 dark:hover:text-blue-400 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors duration-200"
          aria-label="切换暗黑模式"
        >
          <svg x-show="!darkMode" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d={icons.moon} />
          </svg>
          <svg x-show="darkMode" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d={icons.sun} />
          </svg>
        </button>

        <!-- 用户操作按钮 -->
        <div class="hidden md:flex items-center space-x-0 ml-2">
           <a
            href="https://console.cloudcvm.com/cart/goodsList.htm?fpg_id=61&spg_id=20"
            target="_blank"
            rel="noopener noreferrer"
            class="inline-flex items-center px-5 py-2.5 bg-white dark:bg-gray-900 text-gray-700 dark:text-gray-200 font-mono text-sm border border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800 transition-all border-r-0"
          >
            <span>登录</span>
          </a>
          <a
            href="https://console.cloudcvm.com/cart/goodsList.htm?fpg_id=61&spg_id=20"
            target="_blank"
            rel="noopener noreferrer"
            class="inline-flex items-center px-5 py-2.5 bg-blue-600 hover:bg-blue-700 text-white font-mono text-sm transition-all border border-blue-600 hover:border-blue-700"
          >
            <span>立即购买</span>
          </a>
        </div>

        <!-- 移动端菜单按钮 -->
        <button
          x-data="{open: false}"
          x-on:click="open = !open; $dispatch('toggle-mobile-menu', {open})"
          class="lg:hidden p-2.5 rounded-none hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors duration-200 ml-2 border border-gray-200 dark:border-gray-700"
          aria-label="切换菜单"
        >
          <svg x-bind:class="{'hidden': open, 'block': !open}" class="h-6 w-6 text-gray-600 dark:text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d={icons.menu} />
          </svg>
          <svg x-bind:class="{'block': open, 'hidden': !open}" class="h-6 w-6 text-gray-600 dark:text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d={icons.close} />
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- 优化的移动端菜单 -->
  <div
    x-data="{ open: false }"
    x-on:toggle-mobile-menu.window="open = $event.detail.open"
    x-show="open"
    x-transition:enter="transition ease-out duration-200"
    x-transition:enter-start="opacity-0 -translate-y-4"
    x-transition:enter-end="opacity-100 translate-y-0"
    x-transition:leave="transition ease-in duration-150"
    x-transition:leave-start="opacity-100 translate-y-0"
    x-transition:leave-end="opacity-0 -translate-y-4"
    class="lg:hidden fixed inset-x-0 top-16 z-50 w-full overflow-hidden bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800 shadow-xl"
    x-cloak
  >
    <nav class="relative max-h-[calc(100vh-4rem)] overflow-y-auto p-0">
      <div class="space-y-0 divide-y divide-gray-100 dark:divide-gray-800">
        <a href="/" class="mobile-nav-item">首页</a>

        <!-- 移动端菜单项 -->
        {Object.entries(menuData).map(([key, items]) => {
          const menuName = key === 'products' ? '产品中心' : key === 'docs' ? '产品文档' : '支持与服务';
          return (
            <div x-data="{expanded: false}" class="rounded-none bg-white dark:bg-gray-900">
              <button
                x-on:click="expanded = !expanded"
                class="w-full flex items-center justify-between px-6 py-4 text-left hover:bg-gray-50 dark:hover:bg-gray-800 transition-all duration-200 group rounded-none"
              >
                <span class="font-bold font-mono text-gray-900 dark:text-white" x-bind:class="{'text-blue-600 dark:text-blue-400': expanded}">{menuName}</span>
                <svg
                  x-bind:class="{'rotate-180 text-blue-600 dark:text-blue-400': expanded}"
                  class="h-4 w-4 text-gray-400 transition-all duration-200 group-hover:text-blue-600 dark:group-hover:text-blue-400"
                  fill="none" viewBox="0 0 24 24" stroke="currentColor"
                >
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d={icons.chevron} />
                </svg>
              </button>

              <div x-show="expanded" x-collapse x-cloak>
                <div class="bg-gray-50 dark:bg-gray-900/50 border-t border-gray-100 dark:border-gray-800">
                  <div class="p-2">
                    <div class="grid grid-cols-1 gap-1">
                      {items.map(item => (
                        <a href={item.url} target={(item as MenuItem).target || undefined} class="group block p-3 rounded-none hover:bg-white dark:hover:bg-gray-800 transition-all duration-200 border border-transparent hover:border-gray-200 dark:hover:border-gray-700">
                          <div class="flex items-center space-x-3">
                            <div class="w-8 h-8 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-none flex items-center justify-center group-hover:border-blue-500/30 transition-colors duration-200">
                              <span class="w-4 h-4 text-gray-500 dark:text-gray-400 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors duration-200" set:html={Icon({ name: item.icon, className: "w-4 h-4" })}></span>
                            </div>
                            <div class="font-mono text-sm font-medium text-gray-700 dark:text-gray-300 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors duration-200">{item.name}</div>
                          </div>
                        </a>
                      ))}
                    </div>
                  </div>
                </div>
              </div>
            </div>
          );
        })}

        <a href="/pricing" class="mobile-nav-item">产品价格</a>
        <a href="/company" class="mobile-nav-item">关于我们</a>
        <a href="/contact" class="mobile-nav-item">联系我们</a>
        <a href="/blog" class="mobile-nav-item">最新动态</a>
      </div>

      <!-- 移动端用户操作 -->
      <div class="p-6 border-t border-gray-100 dark:border-gray-800">
        <div class="grid grid-cols-2 gap-4">
          <a
            href="https://auth.cnai.art/regist.htm"
            class="flex items-center justify-center px-4 py-3 border border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300 font-mono font-medium transition-colors duration-200 rounded-none text-sm"
          >
            登录
          </a>
          <a
            href="https://auth.cnai.art/regist.htm"
            class="flex items-center justify-center px-4 py-3 bg-blue-600 hover:bg-blue-700 text-white font-mono font-medium transition-colors duration-200 rounded-none text-sm"
          >
            立即购买
          </a>
        </div>
      </div>
    </nav>
  </div>
</header>

<style>
  .nav-link {
    @apply px-4 py-2 text-sm font-medium font-mono text-gray-600 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 transition-colors duration-200 relative;
  }

  .mobile-nav-item {
    @apply flex items-center justify-between w-full px-6 py-4 rounded-none text-gray-700 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-gray-50 dark:hover:bg-gray-800 transition-all duration-200 font-bold font-mono text-sm;
  }

  [x-cloak] {
    display: none !important;
  }
</style>

<script is:inline>
  // 优化的滚动处理 - 使用requestAnimationFrame和防抖
  let header, lastScrollY = 0, ticking = false;

  function handleScroll() {
    if (!header) header = document.querySelector('header');
    if (!header) return;

    const currentScrollY = window.scrollY;

    if (!ticking) {
      requestAnimationFrame(() => {
        // Linear风格：滚动时添加底部边框，而不是阴影
        if (currentScrollY > 10) {
            header.classList.add('border-gray-200', 'dark:border-gray-800');
            header.classList.remove('border-transparent');
        } else {
            // 保持边框
        }
        lastScrollY = currentScrollY;
        ticking = false;
      });
      ticking = true;
    }
  }

  // 使用passive监听器优化性能
  window.addEventListener('scroll', handleScroll, { passive: true });

  // 初始化
  document.addEventListener('DOMContentLoaded', () => {
    header = document.querySelector('header');
    handleScroll();
  });
</script>
