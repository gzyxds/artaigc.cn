---
import { products } from '../../data/products';
import QRModal from '../QRModal.astro';

// 数据处理
// 简单的随机打乱
const shuffled = [...products].sort(() => Math.random() - 0.5);
const images = shuffled.map(p => p.image);

// 确保有足够的图片用于滚动，如果少于10张则重复
let result = images;
while (result.length < 10) {
  result = [...result, ...images];
}

const mid = Math.ceil(result.length / 2);
const marqueeImages = {
  first: result.slice(0, mid),
  second: result.slice(mid)
};

// 图标定义 (SVG)
const icons = {
  Sparkles: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5"><path d="M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962l6.135-1.583A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0l1.583 6.135a2 2 0 0 0 1.437 1.437l6.135 1.583a.5.5 0 0 1 0 .962l-6.135 1.583a2 2 0 0 0-1.437 1.437l-1.583 6.135a.5.5 0 0 1-.963 0z"/><path d="M20 3v4"/><path d="M22 5h-4"/><path d="M4 17v2"/><path d="M5 18H3"/></svg>`,
  Database: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5"><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M3 5V19A9 3 0 0 0 21 19V5"/><path d="M3 12A9 3 0 0 0 21 12"/></svg>`,
  Palette: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5"><circle cx="13.5" cy="6.5" r=".5" fill="currentColor"/><circle cx="17.5" cy="10.5" r=".5" fill="currentColor"/><circle cx="8.5" cy="7.5" r=".5" fill="currentColor"/><circle cx="6.5" cy="12.5" r=".5" fill="currentColor"/><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z"/></svg>`,
  MessageSquareCode: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/><path d="m10 8-2 2 2 2"/><path d="m14 8 2 2-2 2"/></svg>`
};

const featureList = [
  { icon: 'Sparkles', title: "AI数字人", desc: "声音形象克隆，24h在线" },
  { icon: 'Database', title: "知识库系统", desc: "智能问答，文档管理" },
  { icon: 'Palette', title: "聊天绘画", desc: "AI创作，文生图/视频" },
  { icon: 'MessageSquareCode', title: "源码定制", desc: "私有部署，专业支持" }
];
---

<!-- 样式 -->
<style>
  @keyframes marquee-vertical {
    from { transform: translateY(0); }
    to { transform: translateY(-50%); }
  }
  @keyframes marquee-horizontal {
    from { transform: translateX(0); }
    to { transform: translateX(-50%); }
  }
  .animate-marquee-vertical {
    animation: marquee-vertical linear infinite;
  }
  .animate-marquee-horizontal {
    animation: marquee-horizontal linear infinite;
  }
  .animate-blink {
    animation: blink 1s step-end infinite;
  }
  @keyframes blink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0; }
  }

  /* 隐藏滚动条 */
  .scrollbar-hide::-webkit-scrollbar {
    display: none;
  }
  .scrollbar-hide {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
</style>

<!-- 结构 -->
<section class="relative min-h-[80vh] flex items-center overflow-hidden bg-white dark:bg-gray-900 text-black dark:text-white pt-24 pb-16 md:py-24">
  <div class="container mx-auto px-4 relative z-10 w-full">
    <div class="grid lg:grid-cols-2 gap-12 lg:gap-20 items-center">

      {/* 左侧内容区 */}
      <div class="relative space-y-8 md:space-y-10 text-center lg:text-left z-20 lg:pl-10 xl:pl-16">
        {/* 装饰背景 */}
        <div class="absolute inset-0 -z-10 overflow-visible pointer-events-none select-none">
          {/* 顶部聚焦光束 */}
          <div class="absolute top-0 left-1/2 lg:left-0 -translate-x-1/2 lg:-translate-x-1/3 -translate-y-1/2 w-[800px] h-[800px] bg-blue-600/10 rounded-none blur-[100px] mix-blend-multiply dark:mix-blend-screen"></div>

          {/* 科技网格背景 */}
          <div class="absolute inset-0 bg-[linear-gradient(to_right,#80808008_1px,transparent_1px),linear-gradient(to_bottom,#80808008_1px,transparent_1px)] bg-[size:32px_32px] [mask-image:radial-gradient(ellipse_60%_60%_at_50%_50%,#000_70%,transparent_100%)]"></div>
        </div>

        <div class="flex justify-center lg:justify-start">
          <div class="inline-flex items-center gap-2 px-3 py-1.5 md:px-4 rounded-none bg-white/80 dark:bg-white/10 border border-gray-200 dark:border-white/10 shadow-sm backdrop-blur-sm transition-transform hover:scale-105 duration-300">
            <span class="flex h-2 w-2 relative">
              <span class="animate-ping absolute inline-flex h-full w-full rounded-none bg-blue-400 opacity-75"></span>
              <span class="relative inline-flex rounded-none h-2 w-2 bg-blue-500"></span>
            </span>
            <span class="text-sm font-bold text-gray-700 dark:text-gray-200">企业知识库全新升级 v2.0</span>
            <a href="/shop" class="ml-1 text-blue-600 hover:text-blue-700 text-xs font-bold flex items-center">
              查看详情 <span class="ml-0.5">→</span>
            </a>
          </div>
        </div>

        <div class="space-y-4 md:space-y-6">
          <h1 class="text-5xl sm:text-6xl lg:text-7xl font-black leading-tight tracking-tighter text-gray-900 dark:text-white">
            <span class="block pb-2"><span class="text-blue-600">全方位</span> AI解决方案</span>
            <span class="block text-3xl sm:text-4xl lg:text-5xl font-bold text-gray-600 dark:text-gray-300 mt-2 tracking-tight">
              赋能开发者与先进组织
            </span>
          </h1>
        </div>

        <div class="min-h-[3.5em] sm:min-h-[1.75em] flex items-center justify-center lg:justify-start">
          <p class="text-lg sm:text-xl text-gray-600 dark:text-gray-300 max-w-2xl leading-relaxed font-semibold">
            <span id="typewriter-text"></span><span class="animate-blink ml-1 border-r-4 border-blue-500 h-[1.1em] align-middle inline-block"></span>
          </p>
        </div>

        <div class="flex flex-col sm:flex-row justify-center lg:justify-start gap-6 pt-4">
          <button
            class="group relative w-full sm:w-auto px-10 py-5 bg-blue-600 text-white font-bold text-lg tracking-wider overflow-hidden transition-all duration-300 hover:bg-blue-700"
            onclick="window.location.href='/shop'"
          >
            <div class="absolute inset-0 w-0 bg-white/20 transition-all duration-[250ms] ease-out group-hover:w-full"></div>
            <span class="relative flex items-center justify-center gap-2">
              开始免费试用
              <svg class="w-5 h-5 transition-transform group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="square" stroke-linejoin="miter" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg>
            </span>
            {/* 角标装饰 */}
            <div class="absolute top-0 left-0 w-2 h-2 border-t-2 border-l-2 border-white/30"></div>
            <div class="absolute bottom-0 right-0 w-2 h-2 border-b-2 border-r-2 border-white/30"></div>
          </button>

          <button
            class="group relative w-full sm:w-auto px-10 py-5 bg-white/50 dark:bg-white/5 backdrop-blur-sm text-gray-900 dark:text-white font-bold text-lg tracking-wider border border-gray-200 dark:border-white/10 transition-all duration-300 hover:bg-white dark:hover:bg-white/10 hover:border-blue-500/50 hover:shadow-lg hover:shadow-blue-500/10"
            onclick="window.dispatchEvent(new CustomEvent('showQRCodeModal'))"
          >
            <span class="relative flex items-center justify-center gap-2">
              联系技术顾问
              <svg class="w-5 h-5 text-gray-500 group-hover:text-blue-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="square" stroke-linejoin="miter" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path></svg>
            </span>
          </button>
        </div>

        <div class="pt-8 max-w-3xl mx-auto lg:mx-0 border-t border-gray-100 dark:border-gray-800/50 mt-8">
          <div class="grid grid-cols-2 gap-4">
            {featureList.map((item) => (
              <div class="flex items-start gap-3 p-3 rounded-none hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors duration-200 group cursor-default">
                <div class="shrink-0 mt-1 p-2 rounded-none bg-blue-50 dark:bg-blue-900/20 text-blue-600 group-hover:scale-110 transition-transform duration-300">
                  <Fragment set:html={icons[item.icon as keyof typeof icons]} />
                </div>
                <div>
                  <h3 class="font-bold text-gray-900 dark:text-white text-base group-hover:text-blue-600 transition-colors">{item.title}</h3>
                  <p class="text-sm text-gray-500 dark:text-gray-400 mt-1 leading-relaxed line-clamp-1 font-medium">{item.desc}</p>
                </div>
              </div>
            ))}
          </div>
        </div>
      </div>

      {/* 右侧图片展示区 (Mobile Only) */}
      <div class="relative w-full z-10 mt-12 lg:hidden flex items-center justify-center">
         {/* 背景光效 */}
        <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[120%] h-[80%] bg-blue-100/30 dark:bg-blue-900/10 blur-[100px] rounded-none -z-10"></div>

        {/* Mobile: Horizontal Marquee */}
        <div class="flex flex-col gap-5 w-screen -ml-[calc(50vw-50%)]">
          {/* Marquee 1 */}
          <div class="flex overflow-hidden flex-row w-full">
            <div class="flex shrink-0 gap-4 flex-row animate-marquee-horizontal" style="animation-duration: 30s;">
              {marqueeImages.first.map((img, index) => (
                 <a href="/shop" class="block w-[260px] shrink-0 mx-3">
                  <div class="w-full rounded-none border-[3px] border-white dark:border-gray-800 bg-white dark:bg-gray-800 shadow-lg overflow-hidden">
                    <img
                      src={img}
                      alt={`Product Preview ${index + 1}`}
                      class="w-full h-auto bg-gray-50 dark:bg-gray-900"
                      loading="lazy"
                    />
                  </div>
                </a>
              ))}
               {marqueeImages.first.map((img, index) => (
                 <a href="/shop" class="block w-[260px] shrink-0 mx-3">
                  <div class="w-full rounded-none border-[3px] border-white dark:border-gray-800 bg-white dark:bg-gray-800 shadow-lg overflow-hidden">
                    <img
                      src={img}
                      alt={`Product Preview ${index + 1}`}
                      class="w-full h-auto bg-gray-50 dark:bg-gray-900"
                      loading="lazy"
                    />
                  </div>
                </a>
              ))}
            </div>
          </div>

          {/* Marquee 2 (Reverse) */}
           <div class="flex overflow-hidden flex-row w-full">
            <div class="flex shrink-0 gap-4 flex-row animate-marquee-horizontal" style="animation-direction: reverse; animation-duration: 35s;">
              {marqueeImages.second.map((img, index) => (
                 <a href="/shop" class="block w-[260px] shrink-0 mx-3">
                  <div class="w-full rounded-none border-[3px] border-white dark:border-gray-800 bg-white dark:bg-gray-800 shadow-lg overflow-hidden">
                    <img
                      src={img}
                      alt={`Product Preview ${index + 1}`}
                      class="w-full h-auto bg-gray-50 dark:bg-gray-900"
                      loading="lazy"
                    />
                  </div>
                </a>
              ))}
               {marqueeImages.second.map((img, index) => (
                 <a href="/shop" class="block w-[260px] shrink-0 mx-3">
                  <div class="w-full rounded-none border-[3px] border-white dark:border-gray-800 bg-white dark:bg-gray-800 shadow-lg overflow-hidden">
                    <img
                      src={img}
                      alt={`Product Preview ${index + 1}`}
                      class="w-full h-auto bg-gray-50 dark:bg-gray-900"
                      loading="lazy"
                    />
                  </div>
                </a>
              ))}
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

  {/* 右侧图片展示区 (Desktop Only - Absolute Positioned) */}
  <div class="hidden lg:flex absolute top-0 right-0 bottom-0 w-[50vw] z-10 items-center justify-center overflow-hidden pl-12">
      {/* 背景光效 */}
    <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[120%] h-[80%] bg-blue-100/30 dark:bg-blue-900/10 blur-[100px] rounded-none -z-10"></div>

    {/* Desktop: Vertical Marquee */}
    <div class="grid grid-cols-2 gap-6 w-full h-[120%] -my-[10%] overflow-hidden relative">
       {/* 遮罩层 */}
       <div class="absolute inset-x-0 top-0 h-32 bg-gradient-to-b from-white dark:from-gray-900 to-transparent z-20 pointer-events-none"></div>
       <div class="absolute inset-x-0 bottom-0 h-32 bg-gradient-to-t from-white dark:from-gray-900 to-transparent z-20 pointer-events-none"></div>

      {/* Column 1 */}
      <div class="flex overflow-hidden flex-col h-full py-4">
        <div class="flex shrink-0 gap-4 flex-col animate-marquee-vertical" style="animation-duration: 50s;">
          {marqueeImages.first.map((img, index) => (
            <a href="/shop" class="block w-full mb-6">
              <div class="w-full rounded-none border-[4px] border-white dark:border-gray-800 bg-white dark:bg-gray-800 shadow-xl shadow-gray-200/50 dark:shadow-black/50 overflow-hidden hover:scale-[1.02] transition-transform duration-300">
                <img
                  src={img}
                  alt={`Product Preview ${index + 1}`}
                  class="w-full h-auto bg-gray-50 dark:bg-gray-900"
                  loading="lazy"
                />
              </div>
            </a>
          ))}
          {marqueeImages.first.map((img, index) => (
            <a href="/shop" class="block w-full mb-6">
              <div class="w-full rounded-none border-[4px] border-white dark:border-gray-800 bg-white dark:bg-gray-800 shadow-xl shadow-gray-200/50 dark:shadow-black/50 overflow-hidden hover:scale-[1.02] transition-transform duration-300">
                <img
                  src={img}
                  alt={`Product Preview ${index + 1}`}
                  class="w-full h-auto bg-gray-50 dark:bg-gray-900"
                  loading="lazy"
                />
              </div>
            </a>
          ))}
        </div>
      </div>

      {/* Column 2 (Reverse) */}
      <div class="flex overflow-hidden flex-col h-full py-4">
        <div class="flex shrink-0 gap-4 flex-col animate-marquee-vertical" style="animation-direction: reverse; animation-duration: 60s;">
          {marqueeImages.second.map((img, index) => (
            <a href="/shop" class="block w-full mb-6">
              <div class="w-full rounded-none border-[4px] border-white dark:border-gray-800 bg-white dark:bg-gray-800 shadow-xl shadow-gray-200/50 dark:shadow-black/50 overflow-hidden hover:scale-[1.02] transition-transform duration-300">
                <img
                  src={img}
                  alt={`Product Preview ${index + 1}`}
                  class="w-full h-auto bg-gray-50 dark:bg-gray-900"
                  loading="lazy"
                />
              </div>
            </a>
          ))}
          {marqueeImages.second.map((img, index) => (
            <a href="/shop" class="block w-full mb-6">
              <div class="w-full rounded-none border-[4px] border-white dark:border-gray-800 bg-white dark:bg-gray-800 shadow-xl shadow-gray-200/50 dark:shadow-black/50 overflow-hidden hover:scale-[1.02] transition-transform duration-300">
                <img
                  src={img}
                  alt={`Product Preview ${index + 1}`}
                  class="w-full h-auto bg-gray-50 dark:bg-gray-900"
                  loading="lazy"
                />
              </div>
            </a>
          ))}
        </div>
      </div>

    </div>
  </div>
</section>

<QRModal
  qrCodeUrl="/assets/qrcode.png"
  title="联系客服"
  description="扫描二维码添加客服微信"
/>

<script>
  // 打字机效果
  const sentences = [
    '它能够助您快速开发AI应用，缩短80%项目交付周期',
    '它拥有开箱即用的丰富AI应用',
    '它正在努力成为AI应用落地的首选方案',
    '它能够助您快速落地MVP，验证AI应用商业价值'
  ];

  const typeWriterElement = document.getElementById('typewriter-text');

  if (typeWriterElement) {
    let sentenceIndex = 0;
    let charIndex = 0;
    let isDeleting = false;
    let typeSpeed = 100;

    function type() {
      const currentSentence = sentences[sentenceIndex];

      if (isDeleting) {
        typeWriterElement!.textContent = currentSentence.substring(0, charIndex - 1);
        charIndex--;
        typeSpeed = 50;
      } else {
        typeWriterElement!.textContent = currentSentence.substring(0, charIndex + 1);
        charIndex++;
        typeSpeed = 100;
      }

      if (!isDeleting && charIndex === currentSentence.length) {
        typeSpeed = 2000;
        isDeleting = true;
      } else if (isDeleting && charIndex === 0) {
        isDeleting = false;
        sentenceIndex = (sentenceIndex + 1) % sentences.length;
        typeSpeed = 500;
      }

      setTimeout(type, typeSpeed);
    }

    type();
  }

  // 监听二维码弹窗事件
  window.addEventListener('showQRCodeModal', () => {
    const modal = document.getElementById('qr-modal');
    if (modal) {
      modal.classList.add('active');
    }
  });
</script>
