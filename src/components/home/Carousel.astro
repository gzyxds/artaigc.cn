---
import { products } from '../../data/products';
import { getProductImage } from '../../data/images';
import { Image } from 'astro:assets';
import { Icon } from 'astro-icon/components';

// 数据处理
// 简单的随机打乱
const shuffled = [...products].sort(() => Math.random() - 0.5);
const images = shuffled.map(p => getProductImage(p.image)).filter(img => img !== null);

// 确保有足够的图片用于滚动，如果少于10张则重复
let result = images;
while (result.length < 10) {
  result = [...result, ...images];
}

const mid = Math.ceil(result.length / 2);
const marqueeImages = {
  first: result.slice(0, mid),
  second: result.slice(mid)
};

interface FeatureItem {
  icon: string;
  title: string;
  desc: string;
  color: string;
  bg: string;
  border: string;
}

const featureList: FeatureItem[] = [
  {
    icon: 'lucide:sparkles',
    title: "AI数字人",
    desc: "声音形象克隆，24h在线",
    color: "text-purple-500",
    bg: "bg-purple-500/10",
    border: "border-purple-500/20"
  },
  {
    icon: 'lucide:database',
    title: "知识库系统",
    desc: "智能问答，文档管理",
    color: "text-blue-500",
    bg: "bg-blue-500/10",
    border: "border-blue-500/20"
  },
  {
    icon: 'lucide:palette',
    title: "聊天绘画",
    desc: "AI创作，文生图/视频",
    color: "text-pink-500",
    bg: "bg-pink-500/10",
    border: "border-pink-500/20"
  },
  {
    icon: 'lucide:message-square-code',
    title: "商业正版",
    desc: "私有部署，代码开源",
    color: "text-indigo-500",
    bg: "bg-indigo-500/10",
    border: "border-indigo-500/20"
  }
];
---

<!-- 样式 -->
<style>
  @keyframes marquee-vertical {
    from { transform: translateY(0); }
    to { transform: translateY(-50%); }
  }
  @keyframes marquee-horizontal {
    from { transform: translateX(0); }
    to { transform: translateX(-50%); }
  }
  .animate-marquee-vertical {
    animation: marquee-vertical linear infinite;
  }
  .animate-marquee-horizontal {
    animation: marquee-horizontal linear infinite;
  }
  .animate-blink {
    animation: blink 1s step-end infinite;
  }
  @keyframes blink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0; }
  }

  /* 隐藏滚动条 */
  .scrollbar-hide::-webkit-scrollbar {
    display: none;
  }
  .scrollbar-hide {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
</style>

<!-- 结构 -->
<section class="relative min-h-[80vh] flex items-center overflow-hidden bg-background text-primary pt-24 pb-16 md:py-24">
  <div class="container-custom relative z-10">
    <div class="grid lg:grid-cols-2 gap-12 lg:gap-20 items-center">

      {/* 左侧内容区 */}
      <div class="relative space-y-10 md:space-y-12 text-center lg:text-left z-20 lg:pl-4 xl:pl-8">
        {/* 装饰背景 */}
        <div class="absolute inset-0 -z-10 overflow-visible pointer-events-none select-none">
          {/* 顶部聚焦光束 */}
          <div class="absolute top-0 left-1/2 lg:left-0 -translate-x-1/2 lg:-translate-x-1/3 -translate-y-1/2 w-[800px] h-[800px] bg-brand-600/5 rounded-none blur-[100px] mix-blend-multiply dark:mix-blend-screen"></div>

          {/* 科技网格背景 */}
          <div class="absolute inset-0 bg-[linear-gradient(to_right,#80808008_1px,transparent_1px),linear-gradient(to_bottom,#80808008_1px,transparent_1px)] bg-[size:32px_32px] [mask-image:radial-gradient(ellipse_60%_60%_at_50%_50%,#000_70%,transparent_100%)]"></div>
        </div>

        <div class="flex justify-center lg:justify-start">
          <div class="inline-flex items-center gap-3 px-4 py-2 rounded-none bg-surface/80 border border-border backdrop-blur-sm transition-colors hover:border-brand-500/50 duration-300">
            <span class="flex h-2 w-2 relative">
              <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-brand-400 opacity-75"></span>
              <span class="relative inline-flex rounded-full h-2 w-2 bg-brand-500"></span>
            </span>
            <span class="text-xs font-bold text-neutral-700 dark:text-neutral-200 tracking-wider font-mono">V2.0 RELEASE</span>
            <span class="text-xs text-neutral-300 dark:text-neutral-700">|</span>
            <a href="/shop" class="text-brand-600 hover:text-brand-700 dark:text-brand-400 dark:hover:text-brand-300 text-xs font-bold flex items-center group">
              企业知识库升级 <span class="ml-1 transition-transform group-hover:translate-x-0.5">→</span>
            </a>
          </div>
        </div>

        <div class="space-y-6">
          <h1 class="text-5xl sm:text-6xl lg:text-7xl font-bold leading-[1.1] tracking-tight text-neutral-900 dark:text-white font-display text-balance">
            <span class="block text-brand-600 dark:text-brand-500 mb-2">全方位</span>
            AI 解决方案<br/>
            <span class="text-neutral-500 dark:text-neutral-400 font-medium text-3xl sm:text-4xl lg:text-5xl block mt-4">
              赋能开发者与先进组织
            </span>
          </h1>
        </div>

        <div class="min-h-[3.5em] sm:min-h-[1.75em] flex items-center justify-center lg:justify-start">
          <p class="text-lg sm:text-xl text-neutral-600 dark:text-neutral-300 max-w-2xl leading-relaxed font-normal">
            <span id="typewriter-text"></span><span class="animate-blink ml-1 border-r-2 border-brand-500 h-[1.1em] align-middle inline-block"></span>
          </p>
        </div>

        <div class="flex flex-col sm:flex-row justify-center lg:justify-start gap-4 pt-2">
          <button
            class="group relative w-full sm:w-auto px-8 py-4 bg-brand-600 text-white font-semibold text-base tracking-wide overflow-hidden transition-all duration-300 hover:bg-brand-700 rounded-none border border-transparent shadow-sm"
            onclick="window.location.href='/shop'"
          >
            <span class="relative flex items-center justify-center gap-2">
              开始免费试用
              <svg class="w-4 h-4 transition-transform group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="square" stroke-linejoin="miter" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg>
            </span>
          </button>

          <button
            class="group relative w-full sm:w-auto px-8 py-4 bg-surface/50 backdrop-blur-sm text-neutral-900 dark:text-white font-semibold text-base tracking-wide border border-border transition-all duration-300 hover:bg-surface hover:border-brand-500/50 rounded-none"
            onclick="window.dispatchEvent(new CustomEvent('showQRCodeModal'))"
          >
            <span class="relative flex items-center justify-center gap-2">
              联系技术顾问
              <svg class="w-4 h-4 text-neutral-400 group-hover:text-brand-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="square" stroke-linejoin="miter" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path></svg>
            </span>
          </button>
        </div>

        <div class="pt-10 max-w-3xl mx-auto lg:mx-0 border-t border-border mt-10">
          <div class="grid grid-cols-2 gap-4">
            {featureList.map((item) => (
              <div class="group flex items-center gap-4 p-4 bg-surface/30 hover:bg-surface transition-all duration-300 border border-transparent hover:border-border rounded-none">
                <div class={`shrink-0 w-10 h-10 flex items-center justify-center rounded-sm bg-surface border border-border group-hover:border-brand-500/30 group-hover:text-brand-600 transition-colors`}>
                  <div class="text-neutral-500 group-hover:text-brand-600 transition-colors">
                    <Icon name={item.icon} class="w-5 h-5" />
                  </div>
                </div>
                <div class="flex flex-col justify-center min-w-0">
                  <h3 class="text-sm font-semibold text-neutral-900 dark:text-white group-hover:text-brand-600 transition-colors mb-0.5 truncate">{item.title}</h3>
                  <p class="text-xs text-neutral-500 dark:text-neutral-400 leading-snug truncate">{item.desc}</p>
                </div>
              </div>
            ))}
          </div>
        </div>
      </div>

      {/* 右侧图片展示区 (Mobile Only) */}
      <div class="relative w-full z-10 mt-12 lg:hidden flex items-center justify-center">
         {/* 背景光效 */}
        <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[120%] h-[80%] bg-blue-100/30 dark:bg-blue-900/10 blur-[100px] rounded-none -z-10"></div>

        {/* Mobile: Horizontal Marquee */}
        <div class="flex flex-col gap-5 w-screen -ml-[calc(50vw-50%)]">
          {/* Marquee 1 */}
          <div class="flex overflow-hidden flex-row w-full">
            <div class="flex shrink-0 gap-4 flex-row animate-marquee-horizontal" style="animation-duration: 30s;">
              {marqueeImages.first.map((img, index) => (
                 <a href="/shop" class="block w-[260px] shrink-0 mx-3 group">
                  <div class="bento-card bento-card-hover relative w-full overflow-hidden">
                  <Image
                      src={img as any}
                      alt={`Product Preview ${index + 1}`}
                      class="w-full h-auto bg-gray-50 dark:bg-gray-900"
                      width={600}
                      height={338}
                      quality={90}
                      inferSize={true}
                      loading="lazy"
                    />
                    <div class="absolute inset-0 bg-blue-500/0 group-hover:bg-blue-500/10 transition-colors duration-300"></div>
                  </div>
                </a>
              ))}
               {marqueeImages.first.map((img, index) => (
                 <a href="/shop" class="block w-[260px] shrink-0 mx-3 group">
                  <div class="bento-card bento-card-hover relative w-full overflow-hidden">
                  <Image
                      src={img as any}
                      alt={`Product Preview ${index + 1}`}
                      class="w-full h-auto bg-gray-50 dark:bg-gray-900"
                      width={600}
                      height={338}
                      quality={90}
                      inferSize={true}
                      loading="lazy"
                    />
                    <div class="absolute inset-0 bg-blue-500/0 group-hover:bg-blue-500/10 transition-colors duration-300"></div>
                  </div>
                </a>
              ))}
            </div>
          </div>

          {/* Marquee 2 (Reverse) */}
           <div class="flex overflow-hidden flex-row w-full">
            <div class="flex shrink-0 gap-4 flex-row animate-marquee-horizontal" style="animation-direction: reverse; animation-duration: 35s;">
              {marqueeImages.second.map((img, index) => (
                 <a href="/shop" class="block w-[260px] shrink-0 mx-3 group">
                  <div class="bento-card bento-card-hover relative w-full overflow-hidden">
                  <Image
                      src={img as any}
                      alt={`Product Preview ${index + 1}`}
                      class="w-full h-auto bg-gray-50 dark:bg-gray-900"
                      width={600}
                      height={338}
                      quality={90}
                      inferSize={true}
                      loading="lazy"
                    />
                    <div class="absolute inset-0 bg-blue-500/0 group-hover:bg-blue-500/10 transition-colors duration-300"></div>
                  </div>
                </a>
              ))}
               {marqueeImages.second.map((img, index) => (
                 <a href="/shop" class="block w-[260px] shrink-0 mx-3 group">
                  <div class="bento-card bento-card-hover relative w-full overflow-hidden">
                  <Image
                      src={img as any}
                      alt={`Product Preview ${index + 1}`}
                      class="w-full h-auto bg-gray-50 dark:bg-gray-900"
                      width={600}
                      height={338}
                      quality={90}
                      inferSize={true}
                      loading="lazy"
                    />
                    <div class="absolute inset-0 bg-blue-500/0 group-hover:bg-blue-500/10 transition-colors duration-300"></div>
                  </div>
                </a>
              ))}
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

  {/* 右侧图片展示区 (Desktop Only - Absolute Positioned) */}
  <div class="hidden lg:flex absolute top-0 right-0 bottom-0 w-[50vw] z-10 items-center justify-center overflow-hidden pl-12">
      {/* 背景光效 */}
    <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[120%] h-[80%] bg-blue-100/30 dark:bg-blue-900/10 blur-[100px] rounded-none -z-10"></div>

    {/* Desktop: Vertical Marquee */}
    <div class="grid grid-cols-2 gap-6 w-full h-[120%] -my-[10%] overflow-hidden relative">
       {/* 遮罩层 */}
       <div class="absolute inset-x-0 top-0 h-32 bg-gradient-to-b from-white dark:from-gray-900 to-transparent z-20 pointer-events-none"></div>
       <div class="absolute inset-x-0 bottom-0 h-32 bg-gradient-to-t from-white dark:from-gray-900 to-transparent z-20 pointer-events-none"></div>

      {/* Column 1 */}
      <div class="flex overflow-hidden flex-col h-full py-4">
        <div class="flex shrink-0 gap-4 flex-col animate-marquee-vertical" style="animation-duration: 50s;">
          {marqueeImages.first.map((img, index) => (
            <a href="/shop" class="block w-full mb-6 group">
              <div class="bento-card bento-card-hover relative w-full overflow-hidden">
                <div class="corner-marker corner-marker-tr opacity-0 group-hover:opacity-100 transition-opacity"></div>
                <div class="corner-marker corner-marker-bl opacity-0 group-hover:opacity-100 transition-opacity"></div>
                <Image
                  src={img as any}
                  alt={`Product Preview ${index + 1}`}
                  class="w-full h-auto bg-gray-50 dark:bg-gray-900"
                  width={600}
                  height={338}
                  quality={90}
                  inferSize={true}
                  loading="lazy"
                />
                <div class="absolute inset-0 bg-blue-500/0 group-hover:bg-blue-500/5 transition-colors duration-300"></div>
              </div>
            </a>
          ))}
          {marqueeImages.first.map((img, index) => (
            <a href="/shop" class="block w-full mb-6 group">
              <div class="bento-card bento-card-hover relative w-full overflow-hidden">
                <div class="corner-marker corner-marker-tr opacity-0 group-hover:opacity-100 transition-opacity"></div>
                <div class="corner-marker corner-marker-bl opacity-0 group-hover:opacity-100 transition-opacity"></div>
                <Image
                  src={img as any}
                  alt={`Product Preview ${index + 1}`}
                  class="w-full h-auto bg-gray-50 dark:bg-gray-900"
                  width={600}
                  height={338}
                  quality={90}
                  inferSize={true}
                  loading="lazy"
                />
                <div class="absolute inset-0 bg-blue-500/0 group-hover:bg-blue-500/5 transition-colors duration-300"></div>
              </div>
            </a>
          ))}
        </div>
      </div>

      {/* Column 2 (Reverse) */}
      <div class="flex overflow-hidden flex-col h-full py-4">
        <div class="flex shrink-0 gap-4 flex-col animate-marquee-vertical" style="animation-direction: reverse; animation-duration: 60s;">
          {marqueeImages.second.map((img, index) => (
            <a href="/shop" class="block w-full mb-6 group">
              <div class="bento-card bento-card-hover relative w-full overflow-hidden">
                <div class="corner-marker corner-marker-tr opacity-0 group-hover:opacity-100 transition-opacity"></div>
                <div class="corner-marker corner-marker-bl opacity-0 group-hover:opacity-100 transition-opacity"></div>
                <Image
                  src={img as any}
                  alt={`Product Preview ${index + 1}`}
                  class="w-full h-auto bg-gray-50 dark:bg-gray-900"
                  width={600}
                  height={338}
                  quality={90}
                  inferSize={true}
                  loading="lazy"
                />
                <div class="absolute inset-0 bg-blue-500/0 group-hover:bg-blue-500/5 transition-colors duration-300"></div>
              </div>
            </a>
          ))}
          {marqueeImages.second.map((img, index) => (
            <a href="/shop" class="block w-full mb-6 group">
              <div class="bento-card bento-card-hover relative w-full overflow-hidden">
                <div class="corner-marker corner-marker-tr opacity-0 group-hover:opacity-100 transition-opacity"></div>
                <div class="corner-marker corner-marker-bl opacity-0 group-hover:opacity-100 transition-opacity"></div>
                <Image
                  src={img as any}
                  alt={`Product Preview ${index + 1}`}
                  class="w-full h-auto bg-gray-50 dark:bg-gray-900"
                  width={600}
                  height={338}
                  quality={90}
                  inferSize={true}
                  loading="lazy"
                />
                <div class="absolute inset-0 bg-blue-500/0 group-hover:bg-blue-500/5 transition-colors duration-300"></div>
              </div>
            </a>
          ))}
        </div>
      </div>

    </div>
  </div>
</section>

<script>
  // 打字机效果
  const sentences = [
    '它能够助您快速开发AI应用，缩短80%项目交付周期',
    '它拥有开箱即用的丰富AI应用',
    '它正在努力成为AI应用落地的首选方案',
    '它能够助您快速落地MVP，验证AI应用商业价值'
  ];

  const typeWriterElement = document.getElementById('typewriter-text');

  if (typeWriterElement) {
    let sentenceIndex = 0;
    let charIndex = 0;
    let isDeleting = false;
    let typeSpeed = 100;

    function type() {
      const currentSentence = sentences[sentenceIndex];

      if (isDeleting) {
        typeWriterElement!.textContent = currentSentence.substring(0, charIndex - 1);
        charIndex--;
        typeSpeed = 50;
      } else {
        typeWriterElement!.textContent = currentSentence.substring(0, charIndex + 1);
        charIndex++;
        typeSpeed = 100;
      }

      if (!isDeleting && charIndex === currentSentence.length) {
        typeSpeed = 2000;
        isDeleting = true;
      } else if (isDeleting && charIndex === 0) {
        isDeleting = false;
        sentenceIndex = (sentenceIndex + 1) % sentences.length;
        typeSpeed = 500;
      }

      setTimeout(type, typeSpeed);
    }

    type();
  }

  // 由 QRModal 统一处理 showQRCodeModal 事件
</script>
