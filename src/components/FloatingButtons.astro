---
/**
 * FloatingButtons 组件
 *
 * 功能说明：
 * 1. 提供右侧悬浮按钮组，包含售前咨询、售后服务、活动和返回顶部功能
 * 2. 滚动超过300px时显示按钮组
 * 3. 售前咨询按钮支持悬停显示二维码和点击弹出模态框
 * 4. 售后/活动按钮支持悬停显示详情
 * 5. 返回顶部按钮提供平滑滚动功能
 * 6. 响应式设计，适配移动端和桌面端
 *
 * 技术特点：
 * - 使用Astro原生语法，无需React依赖
 * - 集成Alpine.js实现交互功能
 * - 使用Tailwind CSS实现样式和动画
 * - 支持暗黑模式适配
 */

interface Props {
  qrCodeUrl?: string;
}

const { qrCodeUrl = "/assets/qrcode.png" } = Astro.props;
---

<!-- 悬浮按钮组容器 -->
<div
  class="fixed bottom-20 sm:bottom-32 right-4 sm:right-6 z-50 flex flex-col gap-2 sm:gap-3 transition-all duration-300"
  id="floating-buttons"
  x-data="{
    isVisible: true,
    showQRCode: false,
    showAfterSales: false,
    init() {
      // 滚动监听
      window.addEventListener('scroll', () => {
        this.isVisible = window.scrollY > 100;
      });
    }
  }"
  x-show="isVisible"
  x-transition
>
  <!-- 售前咨询按钮 - 蓝色实色 -->
  <div
    class="relative"
    @mouseenter="showQRCode = true"
    @mouseleave="showQRCode = false"
  >
    <button
      class="w-12 h-24 sm:w-12 sm:h-28 bg-blue-600 hover:bg-blue-700 text-white border border-blue-600 hover:border-blue-700 flex flex-col items-center justify-center transition-colors focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-offset-2 rounded-none"
      aria-label="售前咨询"
      @click="document.dispatchEvent(new CustomEvent('openQRModal'))"
    >
      <!-- 耳机图标 -->
      <svg class="h-5 w-5 sm:h-6 sm:w-6 mb-1 sm:mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"/>
      </svg>
      <div class="text-sm font-medium leading-tight font-mono">
        <div>售前</div>
        <div>咨询</div>
      </div>
    </button>

    <!-- 二维码弹窗 - 悬停显示 -->
    <div
      class="absolute bottom-0 right-full mr-2 sm:mr-3 bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 min-w-[160px] sm:min-w-[200px] rounded-none opacity-0 scale-95 translate-y-2 transition-all duration-200 pointer-events-none"
      :class="{ 'opacity-100 scale-100 translate-y-0 pointer-events-auto': showQRCode }"
    >
      <div class="p-3 sm:p-5">
        <div class="text-center">
          <div class="text-xs sm:text-sm text-gray-600 dark:text-gray-300 mb-3 sm:mb-4 font-mono">扫码联系客服</div>
          <div class="flex justify-center">
            <img
              src={qrCodeUrl}
              alt="客服二维码"
              class="w-28 h-28 sm:w-36 sm:h-36 object-contain border border-gray-200 dark:border-gray-700 rounded-none p-1"
            />
          </div>
        </div>
      </div>

      <!-- 小三角指示器 (可选，Bento风格通常可以省略，或者用简单的边框连接) -->
      <!-- 为了保持极简，这里移除复杂的小三角，依靠对齐和边框 -->
    </div>
  </div>

  <!-- 售后/活动按钮 - 白色按钮包含两个选项 -->
  <div
    class="relative"
    @mouseenter="showAfterSales = true"
    @mouseleave="showAfterSales = false"
  >
    <div class="w-12 h-24 sm:w-12 sm:h-28 bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-800 flex flex-col overflow-hidden rounded-none">
      <!-- 售后选项 -->
      <button class="flex-1 flex flex-col items-center justify-center text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors border-b border-gray-100 dark:border-gray-800">
        <!-- 用户图标 -->
        <svg class="h-4 w-4 sm:h-4 sm:w-4 mb-0.5 sm:mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
        </svg>
        <span class="text-sm font-medium font-mono">售后</span>
      </button>

      <!-- 活动选项 -->
      <button class="flex-1 flex flex-col items-center justify-center text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors">
        <!-- 礼品图标 -->
        <svg class="h-4 w-4 sm:h-4 sm:w-4 mb-0.5 sm:mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v13m0-13V6a2 2 0 112 2h-2zm0 0V5.5A2.5 2.5 0 109.5 8H12zm-7 4h14M5 12a2 2 0 110-4h14a2 2 0 110 4M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/>
        </svg>
        <span class="text-sm font-medium font-mono">活动</span>
      </button>
    </div>

    <!-- 售后详情弹窗 -->
    <div
      class="absolute bottom-0 right-full mr-2 sm:mr-3 bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 min-w-[140px] sm:min-w-[180px] rounded-none opacity-0 scale-95 translate-y-2 transition-all duration-200 pointer-events-none"
      :class="{ 'opacity-100 scale-100 translate-y-0 pointer-events-auto': showAfterSales }"
    >
      <div class="p-3 sm:p-5">
        <div class="text-center">
          <div class="text-xs sm:text-sm text-gray-600 dark:text-gray-300 mb-2 sm:mb-3 font-mono">售后服务</div>
          <div class="text-xs text-gray-500 dark:text-gray-400 font-mono">专业售后团队为您服务</div>
        </div>
      </div>
    </div>
  </div>

  <!-- 返回顶部按钮 - 白色方块 -->
  <button
    class="w-12 h-12 sm:w-12 sm:h-12 bg-white dark:bg-gray-900 text-gray-700 dark:text-gray-300 border border-gray-200 dark:border-gray-800 hover:border-blue-500 dark:hover:border-blue-400 flex items-center justify-center transition-colors focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-offset-2 rounded-none"
    aria-label="返回顶部"
    @click="window.scrollTo({ top: 0, behavior: 'smooth' })"
  >
    <!-- 向上箭头图标 -->
    <svg class="h-5 w-5 sm:h-5 sm:w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"/>
    </svg>
  </button>
</div>



<style>
  /* 自定义动画增强 */
  #floating-buttons button {
    transform-origin: center;
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
  }

  #floating-buttons button:active {
    transform: scale(0.95);
  }

  /* 悬停效果增强 - 移除位移，保持静态稳定感，或仅保留微小位移 */
  #floating-buttons button:hover {
    transform: translateY(-1px);
  }

  /* 焦点样式优化 */
  #floating-buttons button:focus {
    outline: none;
    box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.5);
  }
</style>
